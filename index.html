<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BauSitter - Prenotazione</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Quicksand', sans-serif; margin: 0; background: #fdfaf5; color: #444; }
        .container { max-width: 500px; width: 92%; margin: 2rem auto; padding: 2rem; background: white; border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 1.2rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 700; }
        input, select, textarea { width: 100%; padding: 0.8rem; border: 2px solid #eee; border-radius: 12px; font-size: 16px; font-family: inherit; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; margin-top: 10px; }
        .cal-cell { padding: 10px 0; border-radius: 8px; background: #f8f9fa; cursor: pointer; font-weight: 600; }
        .selected { background: #10ac84 !important; color: white; }
        .closed-day { background: #ffebeb; color: #ff7675; cursor: not-allowed; }
        .submit-btn { background: #10ac84; color: white; border: none; padding: 1rem; border-radius: 15px; width: 100%; font-size: 1.1rem; font-weight: 700; cursor: pointer; margin-top: 10px; }
        .price-badge { background: #10ac84; color: white; padding: 10px; border-radius: 10px; display: inline-block; margin: 15px 0; font-weight: 700; }
    </style>
</head>
<body>
<div class="container" id="mainBox">
    <h2 style="text-align:center">Prenota BauSitter üêæ</h2>
    <form id="bookingForm">
        <div class="form-group"><label>Nome</label><input type="text" id="nome" required></div>
        <div class="form-group"><label>Telefono</label><input type="tel" id="tel" value="+39" required></div>
        <div class="form-group"><label>Nome Cane</label><input type="text" id="cane" required></div>
        <div class="form-group">
            <label>Data (Lun-Mar Chiuso üî¥)</label>
            <div id="monthLabel" style="text-align:center; font-weight:700; margin-bottom:5px;"></div>
            <div class="cal-grid" id="calGrid"></div>
            <input type="hidden" id="finalDate" required>
        </div>
        <div style="display: flex; gap: 10px;">
            <div class="form-group" style="flex:1;"><label>Ora Inizio</label><input type="time" id="ora" required></div>
            <div class="form-group" style="flex:1;">
                <label>Durata</label>
                <select id="durata"><option value="1">1h (10‚Ç¨)</option><option value="2">2h (20‚Ç¨)</option><option value="3">3h (25‚Ç¨)</option></select>
            </div>
        </div>
        <div class="form-group"><label>Marina / Posto Barca</label><input type="text" id="marina"></div>
        <div class="form-group"><label>Note</label><textarea id="note" rows="2"></textarea></div>
        <button type="submit" id="btn" class="submit-btn">Conferma Prenotazione</button>
    </form>
</div>

<div class="container" id="successBox" style="display:none; text-align:center;">
    <h2>Inviato! üêæ</h2>
    <p>Prezzo Totale: <span id="pRes" class="price-badge"></span></p>
    <button class="submit-btn" style="background:#e67e22" onclick="generatePDF()">üì• Scarica PDF</button>
    <button class="submit-btn" style="background:#95a5a6" onclick="location.reload()">Nuova Prenotazione</button>
</div>

<script>
    // --- LINK AGGIORNATO ---
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz-MNAY7Oq2b_9_UxcrexJvQaafMzUjplAoCEjA1v-2M69ZkxmJom8tWZ9LnXXiCBsP/exec";
    
    let curMon = 5; 
    const mons = ["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];

    function render() {
        const g = document.getElementById('calGrid'); g.innerHTML = '';
        document.getElementById('monthLabel').innerText = mons[curMon] + " 2025";
        const first = new Date(2025, curMon, 1).getDay();
        const offset = first === 0 ? 6 : first - 1;
        for(let i=0; i<offset; i++) g.innerHTML += '<div></div>';
        for(let d=1; d<=new Date(2025, curMon+1, 0).getDate(); d++) {
            const c = document.createElement('div'); c.className = 'cal-cell';
            const day = new Date(2025, curMon, d).getDay();
            if(day === 1 || day === 2) c.classList.add('closed-day');
            c.innerText = d;
            c.onclick = () => {
                if(c.classList.contains('closed-day')) return;
                document.querySelectorAll('.cal-cell').forEach(x=>x.classList.remove('selected'));
                c.classList.add('selected');
                document.getElementById('finalDate').value = d + " " + mons[curMon] + " 2025";
            };
            g.appendChild(c);
        }
    }

    document.getElementById('bookingForm').onsubmit = (e) => {
        e.preventDefault();
        if(!document.getElementById('finalDate').value) return alert("Scegli una data!");
        const h = document.getElementById('durata').value;
        const p = h=="1"?10:(h=="2"?20:25);
        
        const fd = new URLSearchParams();
        fd.append("nome", document.getElementById('nome').value);
        fd.append("telefono", document.getElementById('tel').value);
        fd.append("cane", document.getElementById('cane').value);
        fd.append("giorno", document.getElementById('finalDate').value);
        fd.append("ora", document.getElementById('ora').value);
        fd.append("durata", h+"h");
        fd.append("prezzo", p+"‚Ç¨");
        fd.append("marina", document.getElementById('marina').value);
        fd.append("note", document.getElementById('note').value);

        fetch(SCRIPT_URL, { method: "POST", body: fd, mode: "no-cors" }).then(()=>{
            document.getElementById('mainBox').style.display='none';
            document.getElementById('successBox').style.display='block';
            document.getElementById('pRes').innerText = p+"‚Ç¨";
        });
    };

    function generatePDF() {
        const { jsPDF } = window.jspdf; const doc = new jsPDF();
        doc.text("Ricevuta BauSitter", 20, 20);
        doc.text("Cliente: " + document.getElementById('nome').value, 20, 40);
        doc.text("Data: " + document.getElementById('finalDate').value, 20, 50);
        doc.text("Prezzo: " + document.getElementById('pRes').innerText, 20, 60);
        doc.save("Ricevuta.pdf");
    }
    render();
</script>
</body>
</html>
