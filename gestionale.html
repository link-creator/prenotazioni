window.callbackGestionale = function(data) {
    const tabella = document.getElementById('tabella');
    tabella.innerHTML = "";
    let totale = 0;

    if (data && data.length > 0) {
        // Forza l'ordine cronologico inverso (ultime prenotazioni in alto)
        data.reverse().forEach(r => {
            // Calcolo del totale
            let pStr = String(r.prezzo || "0");
            let pVal = parseInt(pStr.replace(/[^0-9]/g, '')) || 0;
            totale += pVal;

            // Costruiamo la riga forzando ogni dato nella sua colonna specifica
            tabella.innerHTML += `
                <tr>
                    <td><strong>${r.data || '-'}</strong></td>
                    <td>${r.ora || '-'}</td>
                    <td><strong>${r.cliente || '-'}</strong></td>
                    <td style="color:#10ac84; font-weight:600;">${r.telefono || '-'}</td>
                    <td><strong>${r.cane || '-'}</strong></td>
                    <td><span class="badge-marina">${r.marina || '-'}</span></td>
                    <td><span class="badge-pontile">${r.pontile || '-'}</span></td>
                    <td><span style="color:#10ac84; font-weight:bold;">${r.prezzo || '0€'}</span></td>
                    <td style="font-size:0.8rem; color:#636e72;">${r.note || '-'}</td>
                </tr>
            `;
        });
        document.getElementById('totale').innerText = totale + "€";
    } else {
        tabella.innerHTML = "<tr><td colspan='9' style='text-align:center;'>Nessun dato trovato o errore di caricamento.</td></tr>";
    }
};
